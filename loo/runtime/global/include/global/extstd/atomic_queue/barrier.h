/* -*- mode: c++; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 4 -*- */
#ifndef BARRIER_H_INCLUDED
#define BARRIER_H_INCLUDED

#include <atomic>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace atomic_queue {

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class Barrier {
    std::atomic<unsigned> counter_ = {};

public:
    void wait() {
        counter_.fetch_add(1, std::memory_order_relaxed);
        while(counter_.load(std::memory_order_relaxed))
            ;
    }

    void release(unsigned expected_counter) {
        while(expected_counter != counter_.load(std::memory_order_relaxed))
            ;
        counter_.store(0, std::memory_order_relaxed);
    }
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

} // atomic_queue

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#endif // BARRIER_H_INCLUDED
